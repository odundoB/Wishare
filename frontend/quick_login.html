<!DOCTYPE html>
<html>
<head>
    <title>Quick Login Test</title>
</head>
<body>
    <h1>Quick Login Test</h1>
    <div>
        <h2>Login as Teacher</h2>
        <button onclick="loginAsTeacher()">Login as Teacher</button>
        <p id="teacher-result"></p>
        
        <h2>Login as Student</h2>
        <button onclick="loginAsStudent()">Login as Student (existing)</button>
        <button onclick="loginAsTestStudent()">Login as Test Student</button>
        <p id="student-result"></p>
        
        <h2>Current Status</h2>
        <button onclick="checkStatus()">Check Login Status</button>
        <p id="status-result"></p>
        
        <h2>Test Chat API</h2>
        <button onclick="testChatAPI()">Test Chat Rooms API</button>
        <p id="chat-result"></p>
        
        <h2>Go to Chat Page</h2>
        <button onclick="goToChat()">Open Chat Page</button>
        <button onclick="goToChatSimple()">Open Simple Chat</button>
        <button onclick="goToChatDebug()">Open Chat Debug Complete</button>
        <button onclick="goToChatTest()">Open Chat Test</button>
        <button onclick="goToAuthTest()">Open Auth Test</button>
        <button onclick="goToChatStability()">Open Chat Stability Test</button>
        <button onclick="goToRoomDebug()">Open Room Debugger</button>
        <button onclick="goToMinimalRoomTest()">Minimal Room Test</button>
        <button onclick="goToChatContextDebug()">ChatContext Debug</button>
        <button onclick="goToWorkingChatDemo()">ðŸŽ¯ Working Chat Demo</button>
        
        <h2>Clear Storage</h2>
        <button onclick="clearStorage()">Clear All Tokens</button>
        <p id="clear-result"></p>
    </div>

    <script>
        async function loginAsTeacher() {
            const resultDiv = document.getElementById('teacher-result');
            try {
                const response = await fetch('http://localhost:8000/api/token/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'teacher',
                        password: 'testpass123'
                    })
                });
                
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem('access_token', data.access);
                    localStorage.setItem('refresh_token', data.refresh);
                    resultDiv.innerHTML = 'Teacher login successful!';
                } else {
                    resultDiv.innerHTML = `Login failed: ${JSON.stringify(data)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }
        
        async function loginAsStudent() {
            const resultDiv = document.getElementById('student-result');
            try {
                const response = await fetch('http://localhost:8000/api/token/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'student',
                        password: 'testpass123'
                    })
                });
                
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem('access_token', data.access);
                    localStorage.setItem('refresh_token', data.refresh);
                    resultDiv.innerHTML = 'Student login successful!';
                } else {
                    resultDiv.innerHTML = `Login failed: ${JSON.stringify(data)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }
        
        async function loginAsTestStudent() {
            const resultDiv = document.getElementById('student-result');
            try {
                const response = await fetch('http://localhost:8000/api/token/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'test_student',
                        password: 'testpass123'
                    })
                });
                
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem('access_token', data.access);
                    localStorage.setItem('refresh_token', data.refresh);
                    resultDiv.innerHTML = 'Test Student login successful!';
                } else {
                    resultDiv.innerHTML = `Login failed: ${JSON.stringify(data)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }
        
        async function checkStatus() {
            const resultDiv = document.getElementById('status-result');
            const token = localStorage.getItem('access_token');
            
            if (!token) {
                resultDiv.innerHTML = 'No token found - not logged in';
                return;
            }
            
            try {
                const response = await fetch('http://localhost:8000/api/users/profile/', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                if (response.ok) {
                    resultDiv.innerHTML = `Logged in as: ${data.username} (${data.role})`;
                } else {
                    resultDiv.innerHTML = `Auth check failed: ${JSON.stringify(data)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }
        
        async function testChatAPI() {
            const resultDiv = document.getElementById('chat-result');
            const token = localStorage.getItem('access_token');
            
            if (!token) {
                resultDiv.innerHTML = 'Please login first';
                return;
            }
            
            try {
                const response = await fetch('http://localhost:8000/api/chat/', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                if (response.ok) {
                    resultDiv.innerHTML = `Chat API Success: Found ${Array.isArray(data) ? data.length : 'N/A'} rooms<br>Data: ${JSON.stringify(data).substring(0, 200)}...`;
                } else {
                    resultDiv.innerHTML = `Chat API Failed: ${JSON.stringify(data)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }
        
        function goToChat() {
            window.open('http://localhost:3001/chat', '_blank');
        }
        
        function goToChatSimple() {
            window.open('http://localhost:3001/chat-simple', '_blank');
        }
        
        function goToChatDebug() {
            window.open('http://localhost:3001/chat-debug-complete', '_blank');
        }
        
        function goToChatTest() {
            window.open('http://localhost:3001/chat-test', '_blank');
        }
        
        function goToAuthTest() {
            window.open('http://localhost:3001/auth-test', '_blank');
        }
        
        function goToChatStability() {
            window.open('http://localhost:3001/chat-stability', '_blank');
        }
        
        function goToRoomDebug() {
            window.open('http://localhost:3001/room-debug', '_blank');
        }
        
        function goToMinimalRoomTest() {
            window.open('http://localhost:3001/minimal-room-test', '_blank');
        }
        
        function goToChatContextDebug() {
            window.open('http://localhost:3001/chat-context-debug', '_blank');
        }
        
        function goToWorkingChatDemo() {
            window.open('http://localhost:5173/working-chat-demo', '_blank');
        }
        
        function clearStorage() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            document.getElementById('clear-result').innerHTML = 'Storage cleared!';
            setTimeout(() => checkStatus(), 500);
        }
        
        // Check status on page load
        checkStatus();
    </script>
</body>
</html>